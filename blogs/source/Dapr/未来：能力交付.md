---
title: “能力交付“
date: 2022-03-16 11:41:00
---

> 面向能力的架构，设计应用。

### Dapr 可交付的能力(2021.11)

<img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h0biyndif1j20xy0g1mzg.jpg" alt="overview" style="zoom:80%;" />

- 服务到服务的调用：执行直接的、安全的、服务到服务的方法调用
- 状态管理：创建连续运行的、无状态和有状态的服务
- 发布和订阅：安全、可扩展的服务间消息传递
- 资源绑定和触发器：通过来自大批输入的事件触发，到外部资源(数据库、队列等)的输出绑定
- Actors：将代码和数据封装在可复用的 actor 对象中，一个常用的微服务设计模式
- 可观测性：观测组件和组网服务之间的消息调用
- 机密：对应用机密的安全访问

> 应当允许用户仅加载他们所需要的构件，而不是像今天( - 2021.11) Dapr 实现中的那样，总是预加载所有的构件。

#### 能力：[Open API 规范][10] 自动生成路由

既可以作为自托管的包加载到边车进程中，也可以配置为指向远程托管的 API 服务器。

<img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h0bk3z3s23j20dt09kaa8.jpg" alt="能力包_ API代理" style="zoom:80%;" />

当访问远程 API 时，一个本地 API 代理(可以由 Open API 工具链自动生成)被配置成提供功能性路由，并代理了对远端服务器的请求。可以利用 API 代理做更多的事，如代理可以维护一个本地缓存并使用缓存为重复的请求提供服务，而仅仅将新的请求转发给远端服务器。这个额外的缓存层有以下几个优点：

- 通过直接从缓存中返回缓存的结果，可以提供更好的性能。
- 减少了对远端 API 的调用次数，从而减少了服务消耗成本，并避免了潜在的服务端限流。
- 当远程 API 不可用时，有助于维持系统的可用性。

进一步，关联如下的元信息，以不同的形式提供相同能力的多种选择：远程 API 或本地容器，既 API 代理可以做的是当远程 API 不可用时，切换到本地容器实例。

```yml
metadata:
	name: detection
	offers:
		- name: cog-svc
			type: OpenAPI
			reference: http://...
		- name: lo
			type: Container
```

应用可以基于特定的能力，来对其逻辑建模，而不需要担心能力从那里来以及如何交付，因为所有的细节被隐藏在路由的后面。

#### 能力：分布式 API 管理

使用一个中心化的 API 管理服务来代理所有的云服务器调用，然后通过把策略应用到 API 管理服务上来达到控制服务消费的目的。

另一种不同的 API 管理方案：使用边车，API 代理可以和应用代码一起分布和共存。对比集中式代理，这是一个更具扩展性的架构。而且，同集群中的边车共享相同的配置对象，仍可以通过在边车中放置策略来进行中心化的 API 策略管理。

当把分布式 API 管理能力与本地缓存及自托管能力等结合时，将获得一个高效的、可扩展的、没有任何可能成为瓶颈的中心单点的 API 管理解决方案。

#### 计算推出

计算是被下拉到边缘，而不是从云上推送。

通过动态缩容 Web 应用实例数的方式来降低整体托管的成本，同时还保持用户的满意度。如众多体育迷聚集在一起观看大型比赛时，可以在体育馆附近的边缘节点上动态扩容应用实例，应对访问量激增的情况。在淡季，所有边缘节点缩容到零点，所有客户偶尔的访问被定向到云上托管的实例。

[10]: https://spec.openapis.org/oas/latest.html "Open API spec"
