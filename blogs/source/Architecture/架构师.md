---
title: “架构师概要”
date: 2022-03-04 15:20:58
---

> 架构师最重要的工作是正确的划分组件的边界，将代码自定义尽可能地限制在尽量少的组件中。为当前版本设计刚刚够用的组件，同时为未来的版本预留下天然的扩展点。考虑工程团队的组织架构和能力，以及业务的长期目标。这要求架构师同时具备`技术能力`、`业务视野`、`一些艺术品位`，且需要懂得何时做减法来保持架构的简洁。

### 一个新系统的设计方法

#### 应用架构、系统架构

应用架构的 Role 就是可以部署的的应用，系统架构的 Role 是根据逻辑划分出来的。对于中间件系统，应用架构一般就是系统架构；对于业务系统来说，应用架构和系统架构不同，通常一线的开发团队用应用架构来指导开发、测试、部署，而系统架构更多用于规划汇报。

##### 微信朋友圈和微博的时间线设计

微信朋友圈的动态时间线用拉的模式即可，微博的时间线需要推拉结合。因为微信是***私密社交***，强关系的，就算放开朋友数量限制，除了极少数人，绝大部分人的好友数不会太多。平均一个用户的朋友用户数量可能就几十，多点的也就几百个；微博是***兴趣社交***，弱关系的，必然会出现很多明星和大 V，由此带来粉丝数量超多，热点事件频发的架构设计挑战。明星和大 V 的粉丝数可以几十万上百万上千万，因此微博是推拉结合：对于活跃用户用推模式，可以保证尽快看到微博；对于不活跃用户，采取拉模式，降低系统的压力。

##### CMD id

标准说法是CMD id，command id，如果不同的 command 有不同的版本，那就先 command，后 version；如果是所有 command 统一的版本，那就先 version，后 command；
最常见的的二进制设计技巧：用最开始的1字节（2个也可以）标识版本号，然后紧接着就是各种具体的字段，例如请求ID，请求时间，命令ID……，其中请求ID是标识具体某次请求，每次都不同；

#### 领域驱动设计：DDD 思想

> 从识别系统中不同类型的用户开始，并围绕他们的工作流来设计 API。

1. 按用户维度归组 API

   不同的用户可能有不同的入口点、不同的比列因子、不同的身份验证要求，以及不同的访问策略。

2. 分离实体`只读 API` 和`操作状态的 API `

   只读 API 往往有更大的优化空间，如缓存和预热视图。

#### 结合 Dapr 设计

1. 将系统中的实体建模成 actor，并根据用户的行为来定义 API。
2. 系统所管理的实体类型及可执行的操作
3. 系统所涉及的用户及典型的工作流

